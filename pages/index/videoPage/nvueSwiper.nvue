<template>
	<view class="nvue-swiper-wrap">
		<image class="back-icon" src="@/static/home/back.png" mode="aspectFit" @click="goBack"></image>
		<view class="red-paper-box" v-if="isShowPaper">
			<image :style="{transform: 'rotate(' + rightGiftCircleCss + 'deg)'}" class="circle-right" src="@/static/home/semi-circle.png" mode="aspectFit"></image>
			<image :style="{transform: 'rotate(' + leftGiftCircleCss + 'deg)'}" class="circle-left" src="@/static/home/semi-circle.png" mode="aspectFit"></image>
			<view v-if="this.redPaperTime <= this.paperGiftTime / 2" class="circle-left-mask"></view>
			<image class="red-paper" src="@/static/home/red-paper.png" mode="aspectFit"></image>
		</view>
		<!-- #ifdef MP -->
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'" :vertical="true" @animationfinish="animationfinish" @change="change" :current="current" :indicator-dots="false" @touchstart="mpTouchstart" @touchend="mpTouchend">
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<view v-if="Math.abs(k-index)<=1">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						 -->
						<video
						v-if="isShow"
						:id="list._id+''+index"
						:ref="list._id+''+index"
						:loop="true"
						:muted="list.isplay"
						:controls="false"
						:http-cache="true"
						:page-gesture="false"
						:show-fullscreen-btn="false"
						:show-loading="false"
						:show-center-play-btn="false"
						:enable-progress-gesture="false"
						:src="list.src"
						@ended="ended"
						@click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000; z-index: -1;'"
						:poster="list.cover"
						></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
						<!-- <image
						v-if="!list.playIng"
						:src="list.cover"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'"
						mode="aspectFit"
						></image> -->
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)" :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" src="@/static/shortVideo/index/play.png"></image>
					</view>
					<!-- ç”¨æˆ·å¤´åƒè§†é¢‘ç®€ä»‹ç­‰ -->
					<view class="bottom-wrap">
						<view class="creator-wrap">
							<view class="creator-box">
								<image class="avator" :src="list.href" mode="aspectFit" @click="goAuthorPage(list.authorId)"></image>
								<view class="creator-detail">
									<view class="detail1">
										<text class="title" @click="goAuthorPage(list.authorId)">@{{list.username}}</text>
										<view class="follow" @click="collectShortVideo(list)">
											<text class="follow-txt" v-if="!list.isFollow">+å…³æ³¨</text>
											<text class="follow-txt" v-if="list.isFollow">å·²å…³æ³¨</text>
										</view>
									</view>
									<!-- <text class="share">{{creatorData.shareNum}}äººå·²è½¬å‘</text> -->
								</view>
							</view>
							<text class="detail-desc">{{list.msg}}</text>
						</view>
						
						<view class="barrage-wrap">
							<view class="barrage-box">
								<view class="barrage">
									<text class="tag">å¼¹</text>
									<view class="msg">
										<!-- <text class="line"></text> -->
										<view class="line"></view>
										<text class="txt">å‘é€å¼¹å¹•</text>
									</view>
								</view>
								<view class="follow-wrap" @click="cLike(list)">
									<view class="follow">
										<image v-if="list.like" class="love" src="/static/home/collected.png" mode="aspectFit"></image>
										<image v-if="!list.like" class="love" src="/static/home/collect.png" mode="aspectFit"></image>
										<text class="love-num">{{list.like_n}}</text>
									</view>
								</view>
							</view>
							<view class="line-wrap">
								<view class="bottom-line"></view>
							</view>
						</view>
					</view>
				</view>
			</swiper-item>
		</swiper>
		<!-- #endif -->
		<!-- #ifdef H5 -->
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'" :vertical="true" @animationfinish="animationfinish" @change="change" :current="current" :indicator-dots="false" :duration="duration">
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<view v-if="Math.abs(k-index)<=1">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						 -->
						<video
						v-if="isShow"
						:id="list._id+''+index"
						:ref="list._id+''+index"
						:loop="true"
						:muted="list.isplay"
						:controls="false"
						:http-cache="true"
						:page-gesture="false"
						:show-fullscreen-btn="false"
						:show-loading="false"
						:show-center-play-btn="false"
						:enable-progress-gesture="false"
						:src="list.src"
						@ended="ended"
						@click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000; z-index: -1;'"
						:poster="list.cover"
						></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
						<!-- <image
						v-if="!list.playIng"
						:src="list.cover"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'"
						mode="aspectFit"
						></image> -->
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)" :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" src="@/static/shortVideo/index/play.png"></image>
					</view>
					<!-- ç”¨æˆ·å¤´åƒè§†é¢‘ç®€ä»‹ç­‰ -->
					<view class="bottom-wrap">
						<view class="creator-wrap">
							<view class="creator-box">
								<image class="avator" :src="list.href" mode="aspectFit" @click="goAuthorPage(list.authorId)"></image>
								<view class="creator-detail">
									<view class="detail1">
										<text class="title" @click="goAuthorPage(list.authorId)">@{{list.username}}</text>
										<view class="follow" @click="collectShortVideo(list, false)">
											<text class="follow-txt" v-if="!list.isFollow">+å…³æ³¨</text>
											<text class="follow-txt" v-if="list.isFollow">å·²å…³æ³¨</text>
										</view>
									</view>
									<!-- <text class="share">{{creatorData.shareNum}}äººå·²è½¬å‘</text> -->
								</view>
							</view>
							<text class="detail-desc">{{list.msg}}</text>
						</view>
						
						<view class="detail-slider">
							<slider class="slider-line" :block-size="!isDragging ? '8' : '14'"
								min="0" :max="dataList[k].duration"
								:value="endTime" @change="sliderChange"
								@changing="touchstartFn" backgroundColor="#e9e9e9"
								step="1" activeColor="#5DE89B" />
						</view>
						
						<view class="barrage-wrap">
							<view class="barrage-box">
								<view class="barrage">
									<text class="tag">å¼¹</text>
									<view class="msg" @click="notSupportTip">
										<!-- <text class="line"></text> -->
										<view class="line"></view>
										<text class="txt">å‘é€å¼¹å¹•</text>
									</view>
								</view>
								<view class="follow-wrap" @click="cLike(list)">
									<view class="follow">
										<image v-if="list.like" class="love" src="/static/home/collected.png" mode="aspectFit"></image>
										<image v-if="!list.like" class="love" src="/static/home/collect.png" mode="aspectFit"></image>
										<text class="love-num">{{list.like_n}}</text>
									</view>
								</view>
							</view>
							<view class="line-wrap">
								<view class="bottom-line"></view>
							</view>
						</view>
					</view>
					
				</view>
			</swiper-item>
		</swiper>
		<!-- #endif -->
	</view>
</template>

<script>
	import {
		postVaasVideoFeed,
	} from "@/api/api.js"
	import {
		postVaasFeedback,
		postVaasVideoPlay,
		postVaasVideoCpvideos,
		postVaasLogPlay,
		postVaasLogPlayTm,
		postVaasLogShow,
		getVaasFeedbackList,
	} from "@/api/videoApi.js"
	
	let audo = uni.createInnerAudioContext()
	audo.loop = true
	
	function debounce(fn, delay = 200) {
		let flag;
		let timer;
		return function() {
			let that = this;
			if (flag) clearTimeout(timer)
			flag = true
			timer = setTimeout(() => {
				flag = false
				fn.call(that)
			}, delay)
		}
	}
	
	export default {
		data() {
			return {
				windowWidth: 0,
				windowHeight: 0,
				platform: "",
				model: "",
				deleteHeight: 0,
				dataList: [],
				k: 0,
				oldVideo: "",
				voice: "",
				timeout: "",
				current: 0,
				boxStyle:{//è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
					'height': 0,
					'width': 0,
				},
				
				videoID: "",
				isShow: false,
				
				showPlay: false,//è½¬è½®æ˜¾ç¤ºæ§åˆ¶
				rotates: 0,//è½¬è½®æ—‹è½¬è§’åº¦
				rotateTime: "",//è½¬è½®é€’å½’äº‹ä»¶æ§åˆ¶
				xrotats: "",
				
				mpcleartime: "",
				
				isClick: false,
				
				changeTimeout: "",
				mptime: 0,
				mpstartTime: 0,
				
				duration: 500,
				creatorData: {}, // ä½œè€…/è§†é¢‘ç®€ä»‹
				
				channelsId: '30483', // åªè¦å½±è§†çŸ­è§†é¢‘id, æš‚æ—¶å†™æ­»
				videoType: 1,
				platformType: 3,
				isAuthorPage: 0, // 0 ä¸æ˜¯ 1æ˜¯æŸ¥çœ‹ä½œè€…çš„æ‰€æœ‰ä½œå“
				authorPage: 1, // ä½œè€…åˆ—è¡¨çš„æ¥å£pageå‚æ•°
				authorId: '', // ä½œè€…id
				hasMore: true, // æ˜¯å¦è¿˜æœ‰æ›´å¤šä½œè€…è§†é¢‘
				timer: null, // è®°å½•è§†é¢‘æ’­æ”¾æ˜¯å¦è¶…è¿‡5s
				videoDuration: 0, // è§†é¢‘æ€»æ—¶é•¿
				startTime: 0, // è§†é¢‘å¼€å§‹æ—¶é—´,
				endTime: 0, // endTime - startTime == videoDuration åˆ’èµ°è§†é¢‘æ—¶æ˜¯å¦çœ‹å®Œè§†é¢‘
				endTimer: null, // è®°å½•å½“å‰æ’­æ”¾è¿›åº¦
				
				isShowProgressBarTime: false,//æ˜¯å¦æ‹–åŠ¨è¿›åº¦æ¡ï¼Œå¦‚æœæ‹–åŠ¨ï¼ˆtrueï¼‰åˆ™æ˜¾ç¤ºè¿›åº¦æ¡æ—¶é—´ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºï¼ˆfalseï¼‰ã€1.0.4å·²åºŸå¼ƒï¼Œä½†æ˜¯æ„æ€éœ€è¦è®°ä½ã€‘
				isDragging: false,//falseä»£è¡¨åœæ­¢æ»‘åŠ¨ğŸŒŸğŸ’—
				
				paperGiftTime: 15, // æ’­æ”¾15sè·å¾—å¥–åŠ±
				isShowPaper: false, // å¼€å§‹æ˜¾ç¤ºçº¢åŒ…å¹¶è®¡æ—¶
				redPaperTime: 0, // çº¢åŒ…å¼€å§‹æ—¶é—´
				redPaperTimer: null, // çº¢åŒ…è®¡æ—¶å™¨
				btStamp: 0, // çº¢åŒ…å¼€å§‹æ—¶é—´æˆ³
				etStamp: 0, // ç»“æŸæ—¶é—´æˆ³
			}
		},
		watch:{
			async k(k,old_k){
				// console.log(k, old_k)
				// #ifndef MP
				this.clearToTime();
				// #endif
				this.isShow = false
				this.dataList[old_k].playIng = false//å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
				this.dataList[old_k].isplay = true
				this.dataList[old_k].state = 'pause'
				// await this.getIndexVideoSrc(old_k)
				console.log('é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id+''+old_k)
				// 2.0ç‰ˆæœ¬å·²ç»å»æ‰äº†ä¸‹é¢è¿™ä¸€å¥ï¼Œè§†é¢‘ä¸ç”¨æš‚åœï¼Œåªéœ€è¦æŠŠå£°éŸ³ç¦æ­¢å°±è¡Œ
				uni.createVideoContext(this.dataList[old_k]._id + '' + old_k,this).stop()//å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
				console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½')//æç¤º
				this.dataList[k].state = 'play'
				this.isShow = true
				this.xrotats = setTimeout(()=>{
					this.showPlay = true;
					// #ifndef MP
					this.rotateX();
					// #endif
				},200)
				this.logVideoPlayTm();
				// #ifdef MP
				// å¦‚æœæ˜¯å°ç¨‹åºç«¯
				clearTimeout(this.changeTimeout);
				this.dataList[k].isplay = false
				setTimeout(()=>{
					this.dataList[k].playIng = true
				},250)
				if(this.mptime < 0.2){
					this.changeTimeout = setTimeout(()=>{
						uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
					},1400)
				} else {
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
				}
				// #endif
				// #ifdef H5
				this.dataList[k].isplay = true
				if (!this.dataList[k].src) return
				audo.src = this.dataList[k].src
				if(this.isClick){
					setTimeout(()=>{
						if (typeof WeixinJSBridge == "undefined") {
							setTimeout(()=>{
								audo.play()
								uni.createVideoContext(this.dataList[k]._id+''+k,this).seek(0)
								uni.createVideoContext(this.dataList[k]._id+''+k,this).play()
								setTimeout(()=>{
									this.dataList[k].playIng = true
								},650)
							},500)
						} else {
							WeixinJSBridge.invoke('getNetworkType', {}, e => {
								setTimeout(()=>{
									audo.play()
									uni.createVideoContext(this.dataList[k]._id+''+k,this).seek(0)
									uni.createVideoContext(this.dataList[k]._id+''+k,this).play()
									setTimeout(()=>{
										this.dataList[k].playIng = true
									},850)
								},200)
							})
						}
					},200)
					this.logRedPaperTime();
					this.logVideoPlay()
				} else {
					audo.pause()
					this.dataList[k].state = 'pause'
					uni.createVideoContext(this.dataList[k]._id+''+k,this).seek(0)
					uni.createVideoContext(this.dataList[k]._id+''+k,this).pause()
				}
				// #endif
				var p = k+1;
				console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id+''+p)
			}
		},
		computed: {
			leftGiftCircleCss() {
				if (this.redPaperTime > this.paperGiftTime || !this.isShowPaper) {
					this.isShowPaper = false
					this.redPaperTime = 0;
					clearInterval(this.redPaperTimer)
					this.etStamp = Date.parse(new Date()) / 1000; // è·å–çº¢åŒ…å¼€å§‹çš„æ—¶é—´æˆ³(s)
					if (this.btStamp !== 0) {
						this.postVaasLogPlayTm(this.btStamp, this.etStamp)
						this.btStamp = 0
						this.etStamp = 0
					}
					return 180;
				}
				const deg = 360 / this.paperGiftTime
				return this.redPaperTime * deg + 180;
			},
			rightGiftCircleCss() {
				const deg = 360 / this.paperGiftTime
				if (this.redPaperTime <= Math.floor(this.paperGiftTime / 2)) {
					return this.redPaperTime * deg + 180;
				} else {
					return 360;
				}
			},
		},
		async onLoad(e) {
			this.isAuthorPage = e.isAuthor;
			this.authorId = e.authorId;
			this.getSessionId()
			this.getPlatform();
			this.platform = uni.getSystemInfoSync().platform
			this.model = uni.getSystemInfoSync().model
			var model = this.model
			if(this.platform == 'ios' && (model !== 'iPhone6' || model !== 'iPhone6s' || model !== 'iPhone7' || model !== 'iPhone8')){
				this.deleteHeight = 0//æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
			}
			this.windowWidth = uni.getSystemInfoSync().windowWidth
			this.windowHeight = uni.getSystemInfoSync().windowHeight
			this.boxStyle.width = this.windowWidth + 'px'//ç»™å®½åº¦åŠ px
			this.boxStyle.height = this.windowHeight - this.deleteHeight;//æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
			// è·å–ä¸Šä¸€ä¸ªé¡µé¢çš„è§†é¢‘åˆ—è¡¨ç¼“å­˜
			let vaasList = [];
			let videoInfo = this.$store.state.video;
			if (this.isAuthorPage == 1) {
				vaasList = videoInfo.vaasAuthorList;
				this.current = videoInfo.aK;
				this.k = videoInfo.aK;
				this.authorPage = videoInfo.authorPage
				this.authorId = videoInfo.authorId ? videoInfo.authorId : this.authorId;
			} else {
				vaasList = videoInfo.vaasList;
				this.current = videoInfo.k;
				this.k = videoInfo.k;
			}
			/// è‹¥ç¼“å­˜å­˜åœ¨, ç›´æ¥å¤„ç†; ä¸åœ¨, åˆ™é‡æ–°è·å–æ¥å£
			if (vaasList.length) {
				this.getInitVideoListFormat(vaasList)
			} else {
				// this.get() 
				if (this.isAuthorPage == 1) {
					this.postVaasVideoCpvideos()
				} else {
					this.getShortVideo() //åˆšè¿›å…¥é¡µé¢åŠ è½½æ•°æ®
				}
			}
			// #ifndef MP
			// this.rotateX();
			// #endif
		},
		onShow(){
			console.log('å›åˆ°å‰å°');
			if(this.dataList.length !== 0){
				// #ifdef MP
				this.dataList[this.k].state = 'play';
				uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
				audo.src = this.dataList[this.k].src
				// #endif
				// #ifdef H5
				if(this.isClick){
					this.dataList[this.k].state = 'play';
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).seek(0)
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
					audo.src = this.dataList[this.k].src
					audo.play()
				}
				// #endif
			}
		},
		onHide(){
			// #ifdef MP
			this.dataList[this.k].state = 'pause';
			uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
			// #endif
			// #ifdef H5
			if(this.isClick){
				this.dataList[this.k].state = 'pause';
				uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
				audo.pause()
			}
			// #endif
			this.postVaasLogPlayTm()
			console.log('åˆ°åå°');
		},
		methods: {
			mpTouchend(){
				this.mptime = (new Date()/1000) - this.mpstartTime;
			},
			mpTouchstart(){
				this.mpstartTime = (new Date()/1000);
			},
			dealVoice(){
				uni.showToast({
					title: 'å¤„ç†å£°éŸ³',
					icon: 'none'
				})
			},
			clearToTime(){
				//æ¸…ç†å®šæ—¶å™¨
				for(let i=0;i<20;i++){
					clearTimeout(this.rotateTime);
					clearTimeout(this.xrotats);
					this.showPlay = false;
					this.rotates = 0;
				}
			},
			clearTime(){
				//æ¸…ç†å®šæ—¶å™¨
				for(let i=0;i<20;i++){
					clearTimeout(this.rotateTime);
					clearTimeout(this.xrotats);
				}
			},
			rotateX(){
				// clearTimeout(this.rotateTime);
				this.rotateTime = setTimeout(()=>{
					this.rotateX();
					this.showPlay = true;
					this.rotates += 1;
				},30)
			},
			closeScrollview(){
				// ç‚¹å‡»è¯„è®ºé‡Œé¢çš„å‰å‰ï¼Œå°±ä¼šå…³é—­è¯„è®º
				this.$refs.pinglun.close();
			},
			ended(){
				// 1.æ’­æ”¾å½“å‰è§†é¢‘ç»“æŸæ—¶è§¦å‘ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
				// this.current = this.k+1
			},
			//ç‚¹å‡»æ’­æ”¾&&æš‚åœ
			tapVideoHover(state,event){
				console.log('state--',state);
				if(state=='play'||state=='continue'){
					this.dataList[this.k].state = 'pause';
				}else{
					this.dataList[this.k].state = 'continue';
				}
				if(this.dataList[this.k].state == 'continue'){
					if (!this.isClick) {
						/// é¦–æ¬¡ç‚¹å‡»æ’­æ”¾è¶…è¿‡5såˆ™ä¸ŠæŠ¥è§†é¢‘
						this.logVideoPlay();
						/// ç‚¹å‡»æ’­æ”¾æ—¶æ‰å¼€å§‹è®¡ç®—çº¢åŒ…
						this.logRedPaperTime();
					}
					this.isClick = true;
					this.dataList[this.k].playIng = true
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play();//æš‚åœä»¥åç»§ç»­æ’­æ”¾
					this.logVideoPlayTm();
					// #ifdef MP
					this.dataList[this.k].isplay = false
					// #endif
					// #ifdef H5
					audo.play()
					// #endif
				}
				if(this.dataList[this.k].state == 'pause'){
					clearInterval(this.endTimer)
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause();//æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = true
					// #endif
					// #ifdef H5
					audo.pause()
					// #endif
				}
			},
			async change(event){
				// å‡ºç°åœ¨å±å¹•ä¸Šåˆ™æ›å…‰è§†é¢‘
				this.postVaasLogShow();
				// åˆ‡æ¢è§†é¢‘æ—¶ä¸ŠæŠ¥å½“å‰è§†é¢‘æ—¶é•¿
				this.postVaasLogPlayTm()
				// åˆ‡æ¢è§†é¢‘æ—¶æ¸…é™¤å·²æœ‰å®šæ—¶å™¨
				this.clearVideoTime()
				let videoSrc = await this.getShortVideoUrl(event.detail.current)
				this.dataList[event.detail.current].src = videoSrc
				this.k = event.detail.current
				if (typeof this.dataList[event.detail.current].isFollow !== 'boolean') this.getVaasFeedbackList()
			},
			animationfinish(event){
				// 1.è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªè§†é¢‘å°±è¿›å…¥ get() æ–¹æ³•åŠ è½½è§†é¢‘è¿›å…¥åˆ—è¡¨
				if(this.k == this.dataList.length - 1){
					// this.GET()
					if (this.isAuthorPage == 1) { // åŠ è½½ä½œè€…ä½œå“
						this.postVaasVideoCpvideos(false)
					} else {
						this.getShortVideo2()
					}
				}
			},
			share(){
				uni.showToast({
					title: 'åˆ†äº«',
					icon: 'none'
				})
			},
			toComment(index){
				// æ³¨æ„ç‚¹å‡»è¯„è®ºä¹‹åä¼šæ‰§è¡Œè¿™é‡Œ
				/*
				ï¼ˆ1ï¼‰å…ˆåŠ è½½ç¼“å†²
				ï¼ˆ2ï¼‰è·å–å½“å‰è§†é¢‘ ID ä¿¡æ¯
				ï¼ˆ3ï¼‰ğŸŒŸğŸŒŸğŸŒŸğŸŒŸé‡è¦ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
					- ä¸€å®šè¦è®°å¾—çœ‹ index.vue é‡Œé¢
					 uni.setStorageSync("user",this.peopleList[i]);
					 è¿™ä¸ªä¸œè¥¿ï¼Œç”¨äºå­˜å‚¨å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚åœ¨ æ’ä»¶é‡Œé¢ä¼šä½¿ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œ
					 è®°å¾—å†™ä¸€ä¸‹ã€‚
					 
				ï¼ˆ4ï¼‰æ‰“å¼€è¯„è®º
				*/ 
				uni.showToast({
					title: 'åŠ è½½ä¸­...',
					icon: 'none',
					position: 'bottom',
					duration: 300
				})
				uni.setStorageSync("videoID",this.dataList[index]._id);
				this.videoID = this.dataList[index]._id;
				this.$refs.pinglun.open('bottom')
			},
			cLike(item){
				this.collectShortVideo(item)
				// this.dataList[this.k].like = !this.dataList[this.k].like
				// const video = this.dataList[this.k];
				item.like?item.like_n -= 1:item.like_n += 1;
			},
			//æ¯ä¸€ç»„ç»“æŸæ—¶æ–°çš„è¯·æ±‚
			async getShortVideo2() {
				let data = {
				  channelId: this.channelsId, // é¢‘é“ID
				  loadType: 0, // åŠ è½½ç±»å‹,0-ä¸Šæ‹‰ï¼Œ1-ä¸‹æ‹‰ï¼Œ2-é¦–æ¬¡åˆ·æ–°ï¼›é»˜è®¤ï¼š0
				  platform: this.platformType, // å¹³å°ç±»å‹ï¼š1-Androidï¼Œ2-iOSï¼Œ3-H5ï¼Œ4-å°ç¨‹åºï¼Œ5-webï¼Œå½“å‰é»˜è®¤ï¼›3
				  size: 8, 
				  videoType: this.videoType  // è§†é¢‘ç±»å‹ï¼Œ1-æ¨ªå±ï¼Œ2-ç«–å±
				}
				let res = await postVaasVideoFeed(data)
				if (res.code == 200) {
					var msg = res.data
					// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
					for (let i = 0; i < msg.length; i++) {
						this.dataList.push(new ShortVideoType(msg[i]))
					}
				}
			},
			async getShortVideoUrl(k) {
				let data = { id: this.dataList[k]._id, platform: this.platformType }
				let res = await postVaasVideoPlay(data)
				if (res && res.data && res.data.length > 0) {
					return res.data[0].uri
				} else {
					return ''
				}
			},
			async getShortVideo() {
				let data = {
				  channelId: this.channelsId, // é¢‘é“ID
				  loadType: 0, // åŠ è½½ç±»å‹,0-ä¸Šæ‹‰ï¼Œ1-ä¸‹æ‹‰ï¼Œ2-é¦–æ¬¡åˆ·æ–°ï¼›é»˜è®¤ï¼š0
				  platform: this.platformType, // å¹³å°ç±»å‹ï¼š1-Androidï¼Œ2-iOSï¼Œ3-H5ï¼Œ4-å°ç¨‹åºï¼Œ5-webï¼Œå½“å‰é»˜è®¤ï¼›3
				  size: 8, 
				  videoType: this.videoType  // è§†é¢‘ç±»å‹ï¼Œ1-æ¨ªå±ï¼Œ2-ç«–å±
				}
				uni.showLoading({
					title: 'åŠ è½½ä¸­...',
					mask: true
				});
				let res = await postVaasVideoFeed(data)
				uni.hideLoading();
				if (res.code == 200) {
					var msg = res.data
					this.getInitVideoListFormat(msg)
				}
			},
			postVaasVideoCpvideos(isInit = true) {
				let data = {
					id: this.authorId,
					page: this.authorPage,
					platform: this.platformType,
					size: 20,
					videoType: this.videoType
				}
				uni.showLoading({
					title: 'åŠ è½½ä¸­...',
					mask: true
				});
				postVaasVideoCpvideos(data).then(res => {
					uni.hideLoading();
					if (res.code === 200) {
						let msg = res.data
						if (msg && data.length) {
							this.authorPage++
						} else {
							this.hasMore = false
						}
						if (isInit) {
							this.getInitVideoListFormat(msg)
						} else {
							this.hasMore = true;
							// this.dataList = this.dataList.concat(msg)
							// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
							for (let i = 0; i < msg.length; i++) {
								this.dataList.push(new ShortVideoType(msg[i]))
							}
						}
					} else {
						uni.showToast({
							title: res.msg || res.message,
							icon: 'none'
						})
					}
				})
			},
			/// è·å–æ¥å£æ•°æ®å, å°†æ•°æ®è½¬åŒ–ä¸ºé¡µé¢æ‰€éœ€å‚æ•°
			async getInitVideoListFormat(msg) {
				this.isShow = false;
				// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
				for (let i = 0; i < msg.length; i++) {
					this.dataList.push(new ShortVideoType(msg[i]))
				}
				// å‡ºç°åœ¨å±å¹•ä¸Šåˆ™æ›å…‰è§†é¢‘
				this.postVaasLogShow();
				this.getVaasFeedbackList(); // æ˜¯å¦å…³æ³¨è¯¥ä½œè€…
				// è·å–è§†é¢‘æ’­æ”¾åœ°å€
				await this.getIndexVideoSrc(this.k);
				// 3.æ’­æ”¾å½“å‰è§†é¢‘
				setTimeout(()=>{
					this.isShow = true;
					// #ifdef H5
					this.dataList[this.k].isplay = true;
					// #endif
					// #ifdef MP
					// å¦‚æœæ˜¯å°ç¨‹åºç«¯
					this.dataList[this.k].isplay = false
					this.dataList[this.k].state = 'play'
					// #endif
					this.dataList[this.k].playIng = true
					setTimeout(async ()=>{
						// #ifdef H5
						// uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).seek(0)
						// uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
						// this.dataList[this.k].state = 'pause';
						audo.src = this.dataList[this.k].src;
						/// è‡ªåŠ¨æ’­æ”¾
						this.tapVideoHover(this.dataList[this.k].state)
						// #endif
						// #ifdef MP
						uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
						// #endif
					},500)
				}, 200)
				this.videoID = this.dataList[this.k]._id
			},
			// æ ¹æ®ä¸‹æ ‡è·å–ç›¸åº”çš„é¡µé¢
			async getIndexVideoSrc(k) {
				if (this.dataList[k]?.hasGetUrl && this.dataList[k].src) return;
				let videoSrc = await this.getShortVideoUrl(k)
				this.dataList[k].src = videoSrc
			},
			// ç‚¹èµå…³æ³¨
			collectShortVideo(item, isLike = true) {
			 	if (this.sessionId) {
					let action = !isLike 
						? !item.isFollow ? 'follow' : 'disFollow'
						: item.like ? 'dislike' : 'like'
			 		let data = {
			 			action: action, 
			 			videoId: item._id,
						cpId: item.userID,
						platform: this.platformType,
						sessionId: this.sessionId,
						// userId: item.userID
			 		}
					postVaasFeedback(data).then(res => {
						if (res && res.code == 200) {
							this.dataList.forEach((item, index) => {
								if (item._id == this.dataList[this.k]._id) {
									if (isLike) {
										item.like = !item.like
									} else {
										item.isFollow = !item.isFollow
									}
								}
							})
							this.$forceUpdate(this.dataList)
						} else {
							uni.showToast({
								title: res ? res.message ? res.message : res.msg : 'è¯·æ±‚å¤±è´¥',
								icon: 'none'
							})
						}
					})
			 	} else {
			 		uni.showToast({
			 		    title: 'è¯·å…ˆç™»å½•',
			 		    icon: 'none',
			 		    duration: 800
			 		});
			 		// uni.navigateTo({
			 		//     url: '/pages/index/longin/longin'
			 		// })
			 	}
			},
			getVaasFeedbackList() {
				let data = { action: 'follow' }
				getVaasFeedbackList(data).then(res => {
					if (res.code === 200) {
						let dataItem = this.dataList[this.k];
						let authorInfo = res.data.find(item => dataItem.authorId == item.cpId)
						this.dataList[this.k].isFollow = authorInfo ? true : false
						this.$forceUpdate(this.dataList)
					}
				})
			},
			getPlatform() {
				// å¹³å°ç±»å‹ï¼š1-Androidï¼Œ2-iOSï¼Œ3-H5ï¼Œ4-å°ç¨‹åºï¼Œ5-webï¼Œå½“å‰é»˜è®¤ï¼›3
				let platform = uni.getSystemInfoSync().platform
				if (platform == 'android') {
					this.platform = 1
				} else if (platform == 'ios') {
					this.platform = 2
				} else if (platform == 'devtools') {
					this.platform = 4
				}
				// #ifdef H5
				this.platform = 3
				// #endif
			}, 
			getSessionId() {
				this.sessionId = uni.getStorageSync('sessionId');
			},
			stopVideo() {
				// #ifdef MP
				this.dataList[this.k].state = 'pause';
				uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
				// #endif
				// #ifdef H5
				if(this.isClick){
					this.dataList[this.k].state = 'pause';
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
					audo.pause()
				}
				// #endif
			},
			//è¿”å›
			goBack() {
				// #ifdef  APP-PLUS
				uni.navigateBack({
					delta: 1, //è¿”å›å±‚æ•°ï¼Œ2åˆ™ä¸Šä¸Šé¡µ
				})
				// #endif
				// #ifdef H5
				history.back();
				// #endif
			},
			goAuthorPage(id) {
				uni.navigateTo({
					url: '/pages/index/videoPage/authorPage?authorId=' + id
				})
			},
			// å‡ºç°åœ¨å±å¹•ä¸­
			postVaasLogShow() {
				let data = {
					// logId: "", // ä¸ŠæŠ¥ID
					platform: this.platformType,
					pos: this.k + 1, // è§†é¢‘åœ¨ä¿¡æ¯æµæˆ–è€…ç›¸å…³é¡µå‡ºç°çš„ä½ç½®ï¼Œä»1å¼€å§‹è®¡ç®—
					referPage: `channel_${this.channelsId}-feed`, // å±•ç°æ¥æºï¼Œchannel_xxx-feedé¡µï¼Œvplaypage-ç›¸å…³é¡µ
					videoId: this.dataList[this.k].videoId
				}
				postVaasLogShow(data)
			},
			// ç”¨æˆ·ç‚¹å‡»è§†é¢‘
			postVaasLogPlay() {
				let data = {
					// logId: "",
					platform: this.platformType,
					referPage: `channel_${this.channelsId}-feed`,
					taskId: this.getUuid(), // æ’­æ”¾ä»»åŠ¡å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥é‡‡ç”¨uuidæ–¹å¼ç”Ÿæˆ
					videoId: this.dataList[this.k].videoId
				}
				postVaasLogPlay(data)
			},
			postVaasLogPlayTm(bt, et) {
				let size = this.endTime - this.startTime;
				if (size < 5) return;
				let isBefore = this.dataList[this.k].duration > Math.round(size) ? 1 : 0
				let data = {
					  bt: bt ? bt : this.startTime, // æ’­æ”¾å¼€å§‹æ—¶é—´ç‚¹ï¼Œå•ä½ï¼šç§’
					  et: et ? et : this.endTime, // æ’­æ”¾ç»“æŸæ—¶é—´ç‚¹ï¼Œå•ä½ï¼šç§’
					  platform: this.platformType, 
					  rt: bt ? 1 : isBefore, // ä¸ŠæŠ¥åŸå›  0-æ­£å¸¸ç»“æŸ 1-æå‰åœæ­¢æ’­æ”¾
					  taskId: this.getUuid(),
					  videoId: this.dataList[this.k].videoId
				}
				// console.log('postVaasLogPlayTm', data, this.dataList[this.k].duration);
				postVaasLogPlayTm(data)
			},
			// æ›å…‰æ—¶é—´å®šæ—¶å™¨
			logVideoPlay() {
				clearTimeout(this.timer)
				this.timer = setTimeout(() => {
					this.postVaasLogPlay()
				}, 5000)
			},
			// æ’­æ”¾æ—¶é—´è®¡æ—¶å™¨
			logVideoPlayTm() {
				clearInterval(this.endTimer)
				if (!this.isClick) return;
				this.endTimer = setInterval(() => {
					let context = this.$refs[this.dataList[this.k]._id+''+this.k]
					if (Array.isArray(context)) {
						this.endTime = Math.floor(context[0].currentTime)
					} else {
						this.endTime = Math.floor(context.currentTime)
					}
				}, 1000)
			},
			// çº¢åŒ…è®¡æ—¶å™¨
			logRedPaperTime() {
				this.btStamp = 0
				this.etStamp = 0
				this.redPaperTime = 0;
				this.isShowPaper = true
				clearInterval(this.redPaperTimer)
				this.btStamp = Date.parse(new Date()) / 1000; // è·å–çº¢åŒ…å¼€å§‹çš„æ—¶é—´æˆ³(s)
				this.redPaperTimer = setInterval(() => {
					this.redPaperTime++
					// if (thsi.redPaperTime > this.paperGiftTime) clearInterval(this.redPaperTimer)
				}, 1000)
			},
			clearVideoTime() {
				this.isShowPaper = false;
				this.redPaperTime = 0;
				clearTimeout(this.timer)
				clearInterval(this.endTimer)
				this.endTime = 0;
				this.duration = 0;
			},
			/// è·å–éšæœºuuid
			getUuid () {
			  if (typeof crypto === 'object') {
			    if (typeof crypto.randomUUID === 'function') {
			      return crypto.randomUUID();
			    }
			    if (typeof crypto.getRandomValues === 'function' && typeof Uint8Array === 'function') {
			      const callback = (c) => {
			        const num = Number(c);
			        return (num ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (num / 4)))).toString(16);
			      };
			      return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, callback);
			    }
			  }
			  let timestamp = new Date().getTime();
			  let perforNow = (typeof performance !== 'undefined' && performance.now && performance.now() * 1000) || 0;
			  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
			    let random = Math.random() * 16;
			    if (timestamp > 0) {
			      random = (timestamp + random) % 16 | 0;
			      timestamp = Math.floor(timestamp / 16);
			    } else {
			      random = (perforNow + random) % 16 | 0;
			      perforNow = Math.floor(perforNow / 16);
			    }
			    return (c === 'x' ? random : (random & 0x3) | 0x8).toString(16);
			  })
			},
			sliderChange(e) {
				// console.log('value å‘ç”Ÿå˜åŒ–ï¼š' + e.detail.value)
				this.endTime = e.detail.value
				// this.isDragging = false
				setTimeout(() => {
					this.isDragging = false
				}, 2000)
				uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).seek(this.endTime)
				audo.currentTime = e.detail.value // éŸ³ç”»åŒæ­¥
				if(this.dataList[this.k].state == 'pause'){
					this.dataList[this.k].state = 'play'
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
					audo.play()
				}
				if (!this.isClick) this.logVideoPlayTm()
			},
			touchstartFn() {
				if (!this.isDragging) {
					this.isDragging = true
				}
			},
			touchstartDeb: debounce(function () {
				if (this.isDragging) {
					this.isDragging = true
				}
			}),
			notSupportTip(tip) {
				uni.showToast({
					title: 'æš‚ä¸æ”¯æŒè¯¥åŠŸèƒ½',
					icon:"none"
				})
			},
		},
		destroyed() {
			this.stopVideo();
			clearTimeout(this.timer)
			clearInterval(this.endTimer)
			if (this.isAuthorPage == 1) {
				this.$store.commit({
					type: 'SET_VAAS_AUTHOR_LIST',
					vaasAuthorList: new FormatBack().formatBack(this.dataList),
				})
				this.$store.commit({
					type: 'SET_VAAS_AK',
					ak: this.k,
				})
				this.$store.commit({
					type: 'SET_VAAS_PARAMS',
					authorPage: this.authorPage,
					authorId: this.authorId
				})
			} else {
				this.$store.commit({
					type: 'SET_VAAS_LIST',
					vaasList: new FormatBack().formatBack(this.dataList)
				})
			}
		},
	}
	
	export class ShortVideoType {
		href = '';
		isShowProgressBarTime = false;
		isShowimage = false;
		isplay = true;
		like = false;
		like_n = 0;
		msg = '';
		pinlun = {};
		playIng = false;
		playNumber = 0;
		sms_n = 0;
		src = '';
		state = 'pause';
		title = '';
		userID = '';
		username = '';
		_id = '';
		constructor(obj) {
			this.href = obj.authorAvatar;
			this.isShowProgressBarTime = false;
			this.isShowimage = false;
			this.isplay = true;
			this.like = obj.isCollect;
			this.like_n = obj.likeNum;
			this.msg = obj.title;
			this.pinlun = {};
			this.playIng = false;
			this.playNumber = obj.playNum;
			this.sms_n = 0;
			this.src = obj.h5url;
			this.state = 'pause';
			this.title = obj.title;
			this.userID = obj.authorId;
			this.username = obj.authorName;
			this._id = obj.videoId;
			Object.assign(this, obj)
		}
	}
	export class FormatBack {
		formatBack(list) {
			let backList = []
			backList = list;
			// list.forEach(item => {
			// 	backList.push({
			// 		authorAvatar: item.href,
			// 		authorId: item.userID,
			// 		authorName: item.username,
			// 		category: item.category,
			// 		cover: item.cover,
			// 		duration: item.duration,
			// 		category: item.category,
			// 		duration: item.duration,
			// 		fileSize: item.fileSize,
			// 		pcUrl: item.pcUrl,
			// 		publishTime: item.publishTime,
			// 		shareUrl: item.shareUrl,
			// 		tags: item.tags,
			// 		videoH: item.videoH,
			// 		videoW: item.videoW,
			// 		h5Url: item.src,
			// 		playNum: item.playNumber,
			// 		title: item.msg,
			// 		isCollect: item.like,
			// 		isPlay: false,
			// 		videoId: item._id,
			// 		likeNum: item.like_n,
			// 	})
			// })
			return backList;
		}
	}
</script>

<style scoped lang="scss">
	.nvue-swiper-wrapv {
		position: relative;
	}
	.container {background-color: #000000;}
	.back-icon {
		width: 52rpx;
		height: 52rpx;
		position: fixed;
		left: 36rpx;
		// top: calc(var(--status-bar-height) + 56rpx);
		top: 100rpx;
		z-index: 1;
	}
	.item {
		/* width : 750rpx; */
		background-color: #000000;
		position: relative;
	}
	.videoHover{
		position: absolute;
		top: 0;
		left: 0;
		flex: 1;
		background-color: rgba(0,0,0,0.1);
		justify-content: center;
		align-items: center;
		
		/* border-style: dashed;
		border-color: #DD524D;
		border-width: 1px; */
	}
	.playState{
		width:  160rpx;
		height: 160rpx;
		opacity: 0.2;
	}
	.userInfo{
		position: absolute;
		bottom:110px;
		right: 10px;
		flex-direction: column;
		
	}
	.userAvatar{
		border-radius: 500%;
		margin-bottom: 15px;
		border-style: solid;
		border-width: 2px;
		border-color: #ffffff;
	}
	.userAvatar{
		width : 100rpx;
		height: 100rpx;
	}
	.likeIco,.shareIco,.commentIco{
		width : 60rpx;
		height: 60rpx;
		margin-top: 15px;
	}
	.likeNum,.commentNum,.shareTex{
		color: #ffffff;
		font-size: 30rpx;
		text-align: center;
		margin: 5px;
	}
	.likeNumActive{
		color: red;
	}
	.content{
	  width: 620rpx;
	  z-index: 99;
	  position: absolute;
	  bottom: 30px;
	  /* justify-content: center; */
	  padding: 15rpx;
	  flex-direction: column;
	  justify-content: flex-start;
	  color: #ffffff;
	}
	.userName {
	  font-size: 30rpx;
	  color: #ffffff;
	  margin-top: 80upx;
	}
	.words {
	  margin-top: 10rpx;
	  font-size: 30rpx;
	  color: #ffffff;
	}
	.root{
		background-color: #000000;
	}
	// ----------------------
	.creator-wrap {
		padding: 0 24rpx;
		display: flex;
		flex-direction: column;
		// padding-bottom: 8rpx;
		// margin-bottom: 8rpx;
		position: relative;
		padding-bottom: 8rpx;
	}
	.creator-wrap .detail-desc {
		// margin: 28rpx 0 14rpx;
		margin: 28rpx 0 22rpx;
		font-weight: 400;
		font-size: 28rpx;
		line-height: 32rpx;
		color: #FAFAFA;
		// overflow: hidden;
	}
	.creator-wrap .creator-box {
		display: flex;
		flex-direction: row;
		justify-content: flex-start;
		align-items: center;
	}
	.creator-wrap .avator {
		width: 84rpx;
		height: 84rpx;
		border-radius: 50%;
		background-color: #fafbfb;
		margin-right: 24rpx;
	}
	.creator-wrap .creator-detail {
		display: flex;
		flex-direction: column;
	}
	.creator-wrap .detail1 {
		display: flex;
		flex-direction: row;
		align-items: center;
	}
	.creator-wrap .title {
		font-weight: 400;
		font-size: 32rpx;
		line-height: 36rpx;
		color: #FAFAFA;
		margin-right: 20rpx;
	}
	.creator-wrap .follow {
		padding: 6rpx 20rpx;
		background: rgba(239, 237, 238, 0.3);
		border: 1px solid rgba(239, 237, 238, 0.7);
		border-radius: 40rpx;
	}
	.creator-wrap .detail1 .follow-txt {
		line-height: 34rpx;
		font-weight: 400;
		font-size: 24rpx;
		color: #FAFAFA;
	}
	.creator-wrap .share {
		font-weight: 400;
		font-size: 24rpx;
		line-height: 28rpx;
		color: #FAFAFA;
	}
	.bottom-wrap {
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
	}
	.progress-wrap {
		left: 0;
		right: 0;
		bottom: -12upx;
		position: absolute;
		z-index: 3;
		margin-bottom: 6rpx;
		padding-bottom: 6rpx;
	}
	
	.barrage-wrap {
		// padding: 16rpx 24rpx 56rpx;
		padding: 16rpx 24rpx 0;
		background: rgba(5, 5, 6, 0.7);
		position: relative;
		display: flex;
		flex-direction: column;
		justify-content: center;
	}
	.barrage-wrap .barrage-box {
		display: flex;
		flex-direction: row;
		align-items: center;
	}
	.barrage-wrap .barrage {
		display: flex;
		flex-direction: row;
		align-items: center;
		// width: 146px;
		// height: 26px;
		background: #1D252B;
		// backdrop-filter: blur(15rpx);
		border-radius: 8rpx;
	}
	.barrage-wrap .barrage .tag {
		padding: 8rpx 14rpx;
		background: linear-gradient(138.65deg, rgba(93, 232, 155, 0.1) 2.95%, rgba(0, 104, 98, 0.1) 93.7%);
		border-radius: 8rpx;
		color: #5DE89B;
		font-weight: 800;
	}
	.barrage-wrap .barrage .msg {
		padding-right: 128rpx;
		position: relative;
		display: flex;
		flex-direction: row;
		align-items: center;
	}
	.barrage-wrap .barrage .line {
		margin: 0 8rpx;
		// border: 2rpx solid #939393;
		width: 2rpx;
		height: 20rpx;
		background-color: #939393;
	}
	.barrage-wrap .barrage .txt {
		// padding-left: 18rpx;
		color: #D8D8D8;
		font-size: 24rpx;
		font-weight: 400;
		line-height: 36rpx;
	}
	.barrage-wrap .follow-wrap .follow {
		display: flex;
		align-items: center;
	}
	.barrage-wrap .follow-wrap {
		display: flex;
		align-items: center;
	}
	.barrage-wrap .follow-wrap .follow {
		display: flex;
		flex-direction: row;
	}
	.barrage-wrap .follow-wrap .love {
		margin-left: 28rpx;
		margin-right: 14rpx;
		width: 48rpx;
		height: 48rpx;
	}
	.barrage-wrap .follow-wrap .love-num {
		font-weight: 400;
		font-size: 24rpx;
		line-height: 34rpx;
		color: #fff;
	}
	.barrage-wrap .line-wrap {
		display: flex;
		justify-content: center;
		align-items: center;
	}
	.barrage-wrap .bottom-line {
		margin: 30rpx 0 14rpx;
		background: #FFF;
		border-radius: 6rpx;
		height: 12rpx;
		width: 418rpx;
	}
	
	.detail-slider {
		padding: 0 24rpx;
	}
	.detail-slider .slider-line {
		margin-left: 0;
		margin-right: 0;
	}
	
	.red-paper-box {
		position: absolute;
		top: 260rpx;
		left: 40rpx;
		width: 88rpx;
		height: 88rpx;
		display: flex;
		justify-content: center;
		align-items: center;
		z-index: 3;
	}
	.red-paper-box .red-paper {
		width: 80rpx;
		height: 80rpx;
		position: absolute;
		z-index: 5;
	}
	.red-paper-box .circle-right, 
	.red-paper-box .circle-left,
	.red-paper-box .circle-left-mask {
		width: 44rpx;
		height: 88rpx;
		position: absolute;
		left: 50%;
		transform: rotate(180deg);
		// transform-origin: left;
		transform-origin: 1px 50%;
		z-index: 3;
	}
	.red-paper-box .circle-right {
		z-index: 3;
	}
	.red-paper-box .circle-left {
		z-index: 2;
	}
	.red-paper-box .circle-left-mask {
		z-index: 4;
		background-color: #000;
	}
</style>
